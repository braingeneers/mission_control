# Global auth settings
set $auth_required 1;
set $original_url $scheme://$http_host$request_uri;

# Check if the host is the auth subdomain
if ($host = auth.braingeneers.gi.ucsc.edu) {
    set $auth_required 0;
}

# Preserve the original request details
set $original_request_uri $request_uri;
set $original_host $http_host;

# Define the auth error handling here
error_page 401 = @error401;

location @error401 {
    return 302 $scheme://auth.braingeneers.gi.ucsc.edu:8443/oauth2/start?rd=$original_url;
}