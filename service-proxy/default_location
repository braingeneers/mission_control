# Global authentication configuration
auth_request /oauth2/auth;
auth_request_set $auth_status $upstream_status;
error_page 401 = /oauth2/sign_in;

# Debug logging
add_header X-Auth-Status $auth_status always;

# If authentication succeeds, set the user and email headers
auth_request_set $user   $upstream_http_x_auth_request_user;
auth_request_set $email  $upstream_http_x_auth_request_email;
proxy_set_header X-User  $user;
proxy_set_header X-Email $email;